<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>VA.MHV.PHR.EXAMPLE\Background - FHIR v4.0.1</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link href="fhir.css" rel="stylesheet"/>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap-fhir.css" rel="stylesheet"/>

    <!-- Project extras -->
    <link href="assets/css/project.css" rel="stylesheet"/>
    <link href="assets/css/pygments-manni.css" rel="stylesheet"/>
    <link href="assets/css/jquery-ui.css" rel="stylesheet"/>
  	<link href="assets/css/prism.css" rel="stylesheet" />
    <!-- Placeholder for child template CSS declarations -->
<link href="assets/css/vha-ig-template.css" rel="stylesheet"/>
<!-- Global site tag (gtag.js) - Google Analytics - Moehrke-Research-IGs -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GTLTM76GD7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GTLTM76GD7');
</script>


    <script type="text/javascript" src="fhir-table-scripts.js"> </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="assets/ico/apple-touch-icon-144-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="assets/ico/apple-touch-icon-114-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="assets/ico/apple-touch-icon-72-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" href="assets/ico/apple-touch-icon-57-precomposed.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"2"}
    h3,h4,h5,h6{--heading-prefix:"2"}</style>
    <div id="segment-header" class="segment">  <!-- segment-header -->
      <div class="container">  <!-- container -->
        <!-- Placeholder for child template header declarations -->

<div id="jfm-nav"> 
     <a id="jfm-logo" no-external="true" href="https://johnmoehrke.github.io">
     <img height="50" alt="VA Organization" src="assets/images/va-header-logo.png"/>
     </a>
	 </div>

        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">MyHealtheVet PHR FHIR API</span>
            <br/>
            <span style="display:inline-block;">0.1.3-beta - ci-build



  <img alt="United States of America flag" src="assets/images/usa.svg" height="16" title="United States of America"/>


            </span>
          </p>
        </div>
      </div> <!-- /container -->
    </div>  <!-- /segment-header -->

    <div id="segment-navbar" class="segment">  <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">  <!-- container -->
        <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
          <!--status-bar-->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a class="navbar-brand hidden" href="http://hl7.org/fhir/R4/index.html">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
              <!-- menu.xml  -->

<ul xmlns="http://www.w3.org/1999/xhtml" class="nav navbar-nav">
  <li>
    <a href="index.html">Home</a>
  </li>
  <li>
    <a href="background.html">Background</a>
  </li>
  <li>
    <a href="testplan.html">Test Plan</a>
  </li>
  <li>
    <a href="artifacts.html">Artifacts</a>
  </li>
  <li>
    <a href="downloads.html">Downloads</a>
  </li>
</ul>
            </div>  <!-- /.nav-collapse -->
          </div>  <!-- /.container -->
        </nav>  <!-- /.navbar -->
      <!-- /HEADER CONTENT -->
      </div>  <!-- /container -->
    </div>  <!-- /segment-navbar -->
    <!--status-bar-->

    <div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
      <div class="container">  <!-- container -->
        <ul class="breadcrumb">
          <li><a href='toc.html'><b>Table of Contents</b></a></li><li><b>Background</b></li>

          <span style="float:right;">

            <a href="index.html">&lt;prev</a> | 

            <a href="#bottom">bottom</a>

          | <a href="testplan.html">next&gt;</a>

          </span>

        </ul>
      </div>  <!-- /container -->
    </div>  <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">  <!-- segment-content -->
      <div class="container">  <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
  <!--ReleaseHeader--><p id="publish-box">MyHealtheVet PHR FHIR API - Local Development build (v0.1.3-beta). See the <a href="https://johnmoehrke.github.io/MHV-PHR/history.html">Directory of published versions</a></p><!--EndReleaseHeader-->
  <h2>Background</h2>
  





  <table class="colsi">
    <tr>
  
      <td>
        <i>Page standards status:</i> <a href="http://hl7.org/fhir/R4/versions.html#std-process" title="Standard Status">Informative</a>
        
      </td>
  
  
    </tr>
  </table>








    <p><!-- white space is critical inside of capture --></p>
<div class="markdown-toc">
<ul id="markdown-toc">
  <li><a href="#todo" id="markdown-toc-todo">todo</a></li>
  <li><a href="#data-input-processing" id="markdown-toc-data-input-processing">Data input processing</a></li>
  <li><a href="#general-processing-of-clinical-resources" id="markdown-toc-general-processing-of-clinical-resources">General Processing of clinical resources</a></li>
  <li><a href="#references" id="markdown-toc-references">References</a></li>
  <li><a href="#utility-functions" id="markdown-toc-utility-functions">Utility Functions</a></li>
</ul>

</div>

<p>MyHealtheVet acts as a FHIR Server.</p>

<ul>
  <li><a href="StructureDefinition-VA.MHV.PHR.patient.html">Patient</a>
    <ul>
      <li><a href="StructureDefinition-VA.MHV.PHR.patient-mappings.html#mappings-for-vdif-to-mhv-phr-patientto">Mappings from VDIF - PatientTO</a></li>
      <li><a href="StructureDefinition-VA.MHV.PHR.patient-examples.html">Examples</a></li>
    </ul>
  </li>
  <li><a href="StructureDefinition-VA.MHV.PHR.practitioner.html">Practitioner</a>
    <ul>
      <li><a href="StructureDefinition-VA.MHV.PHR.practitioner-mappings.html#mappings-for-vdif-to-mhv-phr-userto">Mappings from VDIF - UserTO</a></li>
      <li><a href="StructureDefinition-VA.MHV.PHR.practitioner-mappings.html#mappings-for-vdif-to-mhv-phr-authorto">Mappings from VDIF - AuthorTO</a></li>
      <li><a href="StructureDefinition-VA.MHV.PHR.practitioner-examples.html">Examples</a></li>
    </ul>
  </li>
  <li><a href="StructureDefinition-VA.MHV.PHR.location.html">Location</a>
    <ul>
      <li><a href="StructureDefinition-VA.MHV.PHR.location-mappings.html#mappings-for-vdif-to-mhv-phr-hospitallocationto">Mappings from VDIF - HospitalAllocationTO</a></li>
      <li><a href="StructureDefinition-VA.MHV.PHR.location-examples.html">Examples</a></li>
    </ul>
  </li>
  <li><a href="StructureDefinition-VA.MHV.PHR.organization.html">Organization</a>
    <ul>
      <li><a href="StructureDefinition-VA.MHV.PHR.organization-mappings.html#mappings-for-vdif-to-mhv-phr-labsiteid">Mapping from VDIF - LabSiteID</a></li>
      <li><a href="StructureDefinition-VA.MHV.PHR.organization-examples.html">Examples</a></li>
    </ul>
  </li>
  <li><a href="StructureDefinition-VA.MHV.PHR.immunization.html">Immunization</a>
    <ul>
      <li><a href="StructureDefinition-VA.MHV.PHR.immunization-mappings.html#mappings-for-vdif-to-mhv-phr-immunizationto">Mapping from VDIF - ImmunizationTO</a></li>
      <li><a href="StructureDefinition-VA.MHV.PHR.immunization-examples.html">Examples</a></li>
    </ul>
  </li>
  <li><a href="StructureDefinition-VA.MHV.PHR.note.html">Notes</a>
    <ul>
      <li><a href="StructureDefinition-VA.MHV.PHR.note-mappings.html#mappings-for-vdif-to-mhv-phr-noteto">Mapping from VDIF - NoteTO</a></li>
      <li><a href="StructureDefinition-VA.MHV.PHR.note-examples.html">Examples</a></li>
    </ul>
  </li>
  <li><a href="StructureDefinition-VA.MHV.PHR.labReport.html">LabReport</a> including Microbiology and Pathology
    <ul>
      <li><a href="StructureDefinition-VA.MHV.PHR.labReport-mappings.html#mappings-for-vdif-to-mhv-phr-labreportto">Mapping from VDIF - LabReportTO +</a></li>
      <li><a href="StructureDefinition-VA.MHV.PHR.labReport-examples.html">Examples</a></li>
    </ul>
  </li>
  <li><a href="StructureDefinition-VA.MHV.PHR.condition.html">Conditions</a>
    <ul>
      <li><a href="StructureDefinition-VA.MHV.PHR.condition-mappings.html#mappings-for-vdif-to-mhv-phr-problemto">Mapping from VDIF - ProblemTO</a></li>
      <li><a href="StructureDefinition-VA.MHV.PHR.condition-examples.html">Examples</a></li>
    </ul>
  </li>
</ul>

<h3 id="todo">todo</h3>

<p>Not yet done</p>

<ul>
  <li>Radiology Reports
    <ul>
      <li>ImagingExamTO, RadiologyReportTO</li>
    </ul>
  </li>
  <li>ECG/EKG
    <ul>
      <li>ClinicalProcedureTO</li>
    </ul>
  </li>
  <li>Vital Readings
    <ul>
      <li>vitalSignTO</li>
    </ul>
  </li>
</ul>

<p>Note in Muazzam spreadsheet</p>
<ul>
  <li>Appointments</li>
  <li>Medication History</li>
</ul>

<p>Chem-Hem - from HDR</p>

<h4 id="in-progress">in progress</h4>

<ul>
  <li>Radiology Reports
    <ul>
      <li>ImagingExamTO, RadiologyReportTO</li>
    </ul>
  </li>
</ul>

<h4 id="other">other</h4>

<ul>
  <li>Provenance – track where the data has come from, and if from multiple places track all.</li>
</ul>

<p>unknown (FHIR supports the following topics but unclear if this data exists in PHR)</p>

<ul>
  <li>care plan / care team resources</li>
  <li>allergy intolerance resources
    <ul>
      <li>AllergyTO is defined for VIA</li>
    </ul>
  </li>
  <li>encounter resources</li>
  <li>device resources</li>
  <li>goal resources</li>
  <li>procedure resources</li>
  <li>questionnaire / questionnaireResponse resources</li>
  <li>related person resources</li>
  <li>service request resources</li>
  <li>coverage resources</li>
</ul>

<p>The use of FHIR AuditEvent should be used to track all uses of the FHIR API. This is a base configuration of the HAPI FHIR Server. See IHE Implementation Guide on the use of <a href="https://profiles.ihe.net/ITI/BALP/index.html">Basic Audit Log Patterns</a></p>

<h3 id="data-input-processing">Data input processing</h3>

<p>General Pattern</p>

<ol>
  <li>Our FHIR database will assign id value naturally using normal HAPI method (likely GUID)</li>
  <li>Our FHIR database will put external identifiers (e.g. Those from the Vista id such as ImmunizationTO.id) into the .identifier element</li>
  <li>Our FHIR database should have one Organization resource… or are there multiple?</li>
  <li>Our FHIR database will have <a href="background.html#support-resources">support resources</a> for common resource types: Patient, Practitioner, Location, etc – a Patient resource for each patient within the database, Location for all locations, and Practitioner for all clinicians (Users) - So that clinical resources can point at these resources as appropriate. For example when an Immunization was given at a specific location, we point at a Location resource with the details. Thus all clinical resources that were associated with that location all point at the one instance of Location. Same for Practitioner (Users), and Patients.</li>
  <li>Our FHIR database will have Provenance resource indicating each time a resource is created/updated/deleted. This will aid with the management of data changes and provide linkage back to origination and mapping details.</li>
</ol>

<h3 id="general-processing-of-clinical-resources">General Processing of clinical resources</h3>

<div>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="451px" preserveAspectRatio="none" style="width:269px;height:451px;background:#FFFFFF;" version="1.1" viewBox="0 0 269 451" width="269px" zoomAndPan="magnify"><defs><filter height="300%" id="f11fvmev88754" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0" /><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0" /><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3" /><feBlend in="SourceGraphic" in2="blurOut3" mode="normal" /></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="146" x="60.5" y="28.6855">Update MHV-PHR</text><ellipse cx="128" cy="42.6406" fill="#000000" filter="url(#f11fvmev88754)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;" /><rect fill="#FEFECE" filter="url(#f11fvmev88754)" height="35.0938" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="104" x="76" y="72.6406" /><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="81" x="89" y="95.0977">read data VDIF</text><rect fill="#FEFECE" filter="url(#f11fvmev88754)" height="35.0938" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="127" x="64.5" y="171.7344" /><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="104" x="77.5" y="194.1914">lookup id for match</text><polygon fill="#FEFECE" filter="url(#f11fvmev88754)" points="111,226.8281,145,226.8281,157,238.8281,145,250.8281,111,250.8281,99,238.8281,111,226.8281" style="stroke:#A80036;stroke-width:1.5;" /><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="34" x="111" y="243.3291">found?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="81" y="236.4111">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="157" y="236.4111">no</text><rect fill="#FEFECE" filter="url(#f11fvmev88754)" height="35.0938" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="115" x="11" y="260.8281" /><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="92" x="24" y="283.2852">update if needed</text><rect fill="#FEFECE" filter="url(#f11fvmev88754)" height="35.0938" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="83" x="146" y="260.8281" /><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="60" x="159" y="283.2852">create new</text><polygon fill="#FEFECE" filter="url(#f11fvmev88754)" points="128,301.9219,140,313.9219,128,325.9219,116,313.9219,128,301.9219" style="stroke:#A80036;stroke-width:1.5;" /><polygon fill="#FEFECE" filter="url(#f11fvmev88754)" points="128,127.7344,140,139.7344,128,151.7344,116,139.7344,128,127.7344" style="stroke:#A80036;stroke-width:1.5;" /><polygon fill="#FEFECE" filter="url(#f11fvmev88754)" points="101,345.9219,155,345.9219,167,357.9219,155,369.9219,101,369.9219,89,357.9219,101,345.9219" style="stroke:#A80036;stroke-width:1.5;" /><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="54" x="101" y="362.4229">more data?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="167" y="355.5049">yes</text><ellipse cx="128" cy="423.1748" fill="#FFFFFF" filter="url(#f11fvmev88754)" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;" /><ellipse cx="128" cy="423.1748" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.5;" x1="128" x2="128" y1="52.6406" y2="72.6406" /><polygon fill="#A80036" points="124,62.6406,128,72.6406,132,62.6406,128,66.6406" style="stroke:#A80036;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.5;" x1="99" x2="68.5" y1="238.8281" y2="238.8281" /><line style="stroke:#A80036;stroke-width:1.5;" x1="68.5" x2="68.5" y1="238.8281" y2="260.8281" /><polygon fill="#A80036" points="64.5,250.8281,68.5,260.8281,72.5,250.8281,68.5,254.8281" style="stroke:#A80036;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.5;" x1="157" x2="187.5" y1="238.8281" y2="238.8281" /><line style="stroke:#A80036;stroke-width:1.5;" x1="187.5" x2="187.5" y1="238.8281" y2="260.8281" /><polygon fill="#A80036" points="183.5,250.8281,187.5,260.8281,191.5,250.8281,187.5,254.8281" style="stroke:#A80036;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.5;" x1="68.5" x2="68.5" y1="295.9219" y2="313.9219" /><line style="stroke:#A80036;stroke-width:1.5;" x1="68.5" x2="116" y1="313.9219" y2="313.9219" /><polygon fill="#A80036" points="106,309.9219,116,313.9219,106,317.9219,110,313.9219" style="stroke:#A80036;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.5;" x1="187.5" x2="187.5" y1="295.9219" y2="313.9219" /><line style="stroke:#A80036;stroke-width:1.5;" x1="187.5" x2="140" y1="313.9219" y2="313.9219" /><polygon fill="#A80036" points="150,309.9219,140,313.9219,150,317.9219,146,313.9219" style="stroke:#A80036;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.5;" x1="128" x2="128" y1="206.8281" y2="226.8281" /><polygon fill="#A80036" points="124,216.8281,128,226.8281,132,216.8281,128,220.8281" style="stroke:#A80036;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.5;" x1="128" x2="128" y1="151.7344" y2="171.7344" /><polygon fill="#A80036" points="124,161.7344,128,171.7344,132,161.7344,128,165.7344" style="stroke:#A80036;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.5;" x1="167" x2="243" y1="357.9219" y2="357.9219" /><polygon fill="#A80036" points="239,251.3281,243,241.3281,247,251.3281,243,247.3281" style="stroke:#A80036;stroke-width:1.5;" /><line style="stroke:#A80036;stroke-width:1.5;" x1="243" x2="243" y1="139.7344" y2="357.9219" /><line style="stroke:#A80036;stroke-width:1.5;" x1="243" x2="140" y1="139.7344" y2="139.7344" /><polygon fill="#A80036" points="150,135.7344,140,139.7344,150,143.7344,146,139.7344" style="stroke:#A80036;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.5;" x1="128" x2="128" y1="325.9219" y2="345.9219" /><polygon fill="#A80036" points="124,335.9219,128,345.9219,132,335.9219,128,339.9219" style="stroke:#A80036;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.5;" x1="128" x2="128" y1="107.7344" y2="127.7344" /><polygon fill="#A80036" points="124,117.7344,128,127.7344,132,117.7344,128,121.7344" style="stroke:#A80036;stroke-width:1.0;" /><line style="stroke:#A80036;stroke-width:1.5;" x1="128" x2="128" y1="369.9219" y2="412.1748" /><polygon fill="#A80036" points="124,402.1748,128,412.1748,132,402.1748,128,406.1748" style="stroke:#A80036;stroke-width:1.0;" /><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="132" y="392.2578">no</text></g></svg>
</div>
<p><br clear="all" /></p>

<ol>
  <li>given an id value on the data we are given, we look for the cooresponding FHIR Resource with an identifier element equal to that id value. Thus the identifier element within our FHIR database is the linkage to original data id value.</li>
  <li>When nothing is found, we create a new instance of that clinical resource and populate it with the data we are given. Populating the .identifier element with the id of the data we were given.</li>
  <li>When one item is found, we compare the data we have with the data we were given. If no change, then nothing more is done. If there is a difference, then we update our data.</li>
  <li>When creating a new instance, or updating an existing instance, create a Provenance instance to track what was imported, from what, to what, when, and given some detail to indicate the translation used.</li>
</ol>

<h3 id="references">References</h3>

<p>Source of data received from VDIF using a SOAP xml schema that might be from one of:</p>

<ul>
  <li><a href="https://github.com/department-of-veterans-affairs/mhv-np-via-wsclient/blob/development/src/main/resources/VIA_v4.0.7_uat.wsdl">VIA_v4.0.7_uat.wsdl</a></li>
  <li><a href="https://github.com/department-of-veterans-affairs/mhv-ap-vde-support/blob/development/src/test/wsdl/mockey-mdws3-service.wsdl">mockey-mdws3-service.wsdl</a></li>
  <li><a href="https://github.com/department-of-veterans-affairs/mhv-hla-app-ui/blob/dbb0301be4a17f31e67048300d72c87c0977aa09/hra-mock-via-app/src/main/java/gov/va/hra/integration/via/mock/ws/EmrService.wsdl">EmrService.wsdl</a></li>
  <li>VA <a href="http://www.vistapedia.com/index.php/Main_Page">Vista Fileman</a></li>
</ul>

<h3 id="utility-functions">Utility Functions</h3>

<p>To support functions and resources:</p>

<h4 id="support-resources">Support Resources</h4>

<p>To support the primary FHIR Resources, there are some untility Resources that will be needed. These will be created upon demand, based on a lookup need.</p>

<h5 id="getpractitioner">GetPractitioner()</h5>

<p>Input: UserTO, AuthorTO, etc</p>

<p>Return: a Practitioner resource reference</p>

<p>If a Practitioner is not found given the input parameters, then one is created and populated with the input parameters.</p>

<p>If a Practitioner is found, and the details given are different, then presume parameters are newer and use them to update the found Practitioner Resource.</p>

<p>Profiled <a href="StructureDefinition-VA.MHV.PHR.practitioner.html">Practitioner</a></p>

<h5 id="getpatient">GetPatient()</h5>

<p>Input: ICN, PatientTO</p>

<p>Return: a Patient resource reference</p>

<p>If a Patient is not found given the input parameters, then one is created and populated with the input prameters.</p>

<p>If a Patient is found, and the details given are different, then presume parameters are newer and use them to update the found Patient Resource.</p>

<p><strong>QUESTION: Should the patient also be populated with given patient demographics found in eVault?</strong></p>

<p>Profiled <a href="StructureDefinition-VA.MHV.PHR.patient.html">Patient</a></p>

<h5 id="getlocation">GetLocation()</h5>

<p>Input: hospitalLocationTO, SiteTO</p>

<p>Return: a Location resource reference</p>

<p>If a Location is not found given the input parameters, then one is created and populated with the input prameters.</p>

<p>If a Location is found, and the details given are different, then presume parameters are newer and use them to update the found Location Resource.</p>

<p>Profiled <a href="StructureDefinition-VA.MHV.PHR.location.html">Location</a></p>

<h5 id="getorganization">GetOrganization()</h5>

<p>Input: organiztion id (e.g. Lab id)</p>

<p>Return: a Organization resource reference</p>

<p>If a Organization is not found given the input parameters, then one is created and populated with the input prameters.</p>

<p>If a Organization is found, and the details given are different, then presume parameters are newer and use them to update the found Organization Resource.</p>

<p>Profiled <a href="StructureDefinition-VA.MHV.PHR.organization.html">Organization</a></p>

<h4 id="conversions">Conversions</h4>

<p>Historic data is using different dataTypes that can be well defined</p>

<h5 id="convertdate">ConvertDate()</h5>

<p>Input: Fileman Date</p>

<p>Return: FHIR DateTime</p>

<p>Given that the Fileman date is slightly different than HL7. The conversion is simple.</p>

<p>See <a href="http://www.vistapedia.com/index.php/Date_formats">FileMan date</a></p>

<h5 id="code-lookup">Code Lookup</h5>

<p>Most of the historic data just uses strings. Will need some method to convert these enum or strings to a standards based code like LOINC, SNOMED, CVX, NDC, or other. These utilities can be based on a <a href="http://hl7.org/fhir/conceptmap.html">FHIR ConceptMap</a> resource, thus making maintaining it easy.</p>

<p>For every context use of a concept encoded as a string, we presume they are unique within that context. The context identifies a specific ConceptMap, and a lookup of the string in that ConceptMap will result in the mapped standard code value.</p>

<p>A failure to find a ConceptMap can be recorded simply as the given string. These cases should be logged for evaluation and possiblly update of the given ConceptMap.</p>

<h5 id="id-vs-identifier">Id vs Identifier</h5>

<p>Our FHIR database will track linkages to source objects using the FHIR resource <code class="language-plaintext highlighter-rouge">.identifier</code> element, and the Vista <code class="language-plaintext highlighter-rouge">.id</code> element.</p>

<ol>
  <li>As far as I can tell the <code class="language-plaintext highlighter-rouge">.id</code> values coming from Vista (Fileman) are given to us as strings. I presume unique strings at the source for that given context of that data. (for a given Vista instance the ImmunizationTO.id is unique, but that id value might be a different ImmunizationTO object at a different Vista site, and that id value on a different object like NoteTO at the original Vista site)</li>
  <li>The <code class="language-plaintext highlighter-rouge">.id</code> values seem to have a two or three part to them separated by <code class="language-plaintext highlighter-rouge">;</code>. I don’t know if there is something we can interpret, or if I am just looking at non-real examples.</li>
  <li>In FHIR <a href="http://hl7.org/fhir/datatypes.html#Identifier">Identifier datatype</a> tend to be made up of two parts. The identifier value, and the system value within which that identifier value is known to be unique. We should define a system value for each Vista Site, and each context. In this way when more data sources come along we don’t have clashes of id because we can differentiate them with the system+id. For example when we receive Cerner data.</li>
  <li>Thus when we know the data received is from VDIF we can look up the given id as identifier of system+id.</li>
</ol>

<p>The system value should be composed of the Vista site and object context</p>

<blockquote>
  <p>{canonical root}/Vista/{Vista Site}/{context}</p>
</blockquote>

<p>Context:</p>

<ul>
  <li>UserTO.id</li>
  <li>PatientTO.id</li>
  <li>AutorTO.id</li>
  <li>HospitalLocationTO.id</li>
  <li>ImmunizationTO.id</li>
  <li>NoteTO.id</li>
  <li>LabReportTO.id</li>
  <li>LabReportTO.caseNumber</li>
  <li>LabSpecimenTO.id</li>
  <li>LabResultTO.labSiteId</li>
  <li>LabTestTO.id</li>
</ul>

<p>For example, for Vista site 111, and the UserTO.id context:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://johnmoehrke.github.io/MHV-PHR/Vista/111/UserTO.id
</code></pre></div></div>




</div>
        </div>  <!-- /inner-wrapper -->
      </div>  <!-- /row -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-content -->

  <script type="text/javascript" src="assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script type="text/javascript" src="assets/js/jquery-ui.min.js"> </script>

  <script type="text/javascript">
    $(document).ready(function(){
      if(window.location.hash != "") {
          $('a[href="' + window.location.hash + '"]').click()
      }
    });
  </script>
  <a name="bottom"> </a>
  <div id="segment-footer" igtool="footer" class="segment">  <!-- segment-footer -->
    <div class="container">  <!-- container -->

      <div style="background-color:var(--footer-nav-bg-color)">
        <table style="width:100%">
          <tbody>
            <tr>
              <td style="text-align:left">&#xA0;

                <a href="index.html">&lt;prev</a>

              </td>
              <td style="text-align:center">
                <a href="#top">top</a>
              </td>
              <td style="text-align:right">&#xA0;

                <a href="testplan.html">next&gt;</a>

              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="inner-wrapper">
        <p>
          IG &#169; 2022+ <a style="color:var(--footer-hyperlink-text-color)" href="http://healthcaresecprivacy.blogspot.com">John Moehrke (himself)</a>.  Package va.mhv.phr.example#0.1.3-beta based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Wed, Jan 11, 2023 06:10-0600">2023-01-11</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)">
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                  | <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://github.com/JohnMoehrke/MHV-PHR/issues/new/choose">New Issue</a> | <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://github.com/JohnMoehrke/MHV-PHR/issues">Issues</a>
                
          </span>
        </p>
      </div>  <!-- /inner-wrapper -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
    <div class="container">  <!-- container -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-post-footer -->
  
  <!-- JS and analytics only. -->
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="assets/js/bootstrap.min.js"> </script>
  <script type="text/javascript" src="assets/js/respond.min.js"> </script>
  <script type="text/javascript" src="assets/js/anchor.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard-btn.js"> </script>
  <script>anchors.options.visible = 'hover'
anchors.add()</script>
  
<!-- feedback form - Google forms -->
<!-- v0.1, 2021-01-09 -->


  
    
  


  
    
  



<!-- / feedback form  -->

  <!-- Analytics Below
  ================================================== -->
  </body>
</html>

