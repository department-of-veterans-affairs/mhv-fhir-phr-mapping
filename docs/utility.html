<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE HTML>
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>Utility Functions - MyHealtheVet PHR FHIR API v0.3.8</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="author" content="http://hl7.org/fhir"/>

    <link href="fhir.css" rel="stylesheet"/>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap-fhir.css" rel="stylesheet"/>

    <!-- Project extras -->
    <link href="assets/css/project.css" rel="stylesheet"/>
    <link href="assets/css/pygments-manni.css" rel="stylesheet"/>
    <link href="assets/css/jquery-ui.css" rel="stylesheet"/>
  	<link href="assets/css/prism.css" rel="stylesheet" />
    <!-- Placeholder for child template CSS declarations -->
<link href="assets/css/vha-ig-template.css" rel="stylesheet"/>



    <script type="text/javascript" src="fhir-table-scripts.js"> </script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!-- Favicons -->
    <link rel="fhir-logo" sizes="144x144" href="assets/ico/icon-fhir-144.png"/>
    <link rel="fhir-logo" sizes="114x114" href="assets/ico/icon-fhir-114.png"/>
    <link rel="fhir-logo" sizes="72x72" href="assets/ico/icon-fhir-72.png"/>
    <link rel="fhir-logo" href="assets/ico/icon-fhir-57.png"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png"/>
  </head>
  <body onload="document.body.style.opacity='1'">

	  <script src="assets/js/prism.js"></script>

    <style type="text/css">h2{--heading-prefix:"4"}
    h3,h4,h5,h6{--heading-prefix:"4"}</style>
    <div id="segment-header" class="segment">  <!-- segment-header -->
      <div class="container">  <!-- container -->
        <!-- Placeholder for child template header declarations -->

<div id="va-nav"> 
     <a id="va-logo" no-external="true" href="https://va.gov">
     <img height="50" alt="VA Organization" src="assets/images/va-header-logo.png"/>
     </a>
	 </div>

        <div id="ig-status">
          <p><span style="font-size:12pt;font-weight:bold">MyHealtheVet PHR FHIR API</span>
            <br/>
            <span style="display:inline-block;">0.3.8 - trial-use



  <img alt="United States of America flag" src="assets/images/usa.svg" height="16" title="United States of America"/>


            </span>
          </p>
        </div>
      </div> <!-- /container -->
    </div>  <!-- /segment-header -->

    <div id="segment-navbar" class="segment">  <!-- segment-navbar -->
      <div id="stripe"> </div>
      <div class="container">  <!-- container -->
        <!-- HEADER CONTENT -->

        <nav class="navbar navbar-inverse">
          <!--status-bar-->
          <div class="container">
            <button data-target=".navbar-inverse-collapse" class="navbar-toggle" data-toggle="collapse" type="button">
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
              <span class="icon-bar"> </span>
            </button>
            <a class="navbar-brand hidden" href="http://hl7.org/fhir/R4/index.html">FHIR</a>
            <div class="nav-collapse collapse navbar-inverse-collapse">
              <!-- menu.xml  -->

<ul xmlns="http://www.w3.org/1999/xhtml" class="nav navbar-nav">
  <li>
    <a href="index.html">Home</a>
  </li>
  <li>
    <a href="api.html">API</a>
  </li>
  <li class="dropdown">
    <a data-toggle="dropdown" href="#" class="dropdown-toggle">Vista Mapping
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li>
        <a href="background.html">background</a>
      </li>
      <li>
        <a href="background.html#allergy">Allergy</a>
      </li>
      <li>
        <a href="background.html#chem-hem">Chem-Hem</a>
      </li>
      <li>
        <a href="background.html#condition">Condition</a>
      </li>
      <li>
        <a href="background.html#ecg">ECG</a>
      </li>
      <li>
        <a href="background.html#immunization">Immunization</a>
      </li>
      <li>
        <a href="background.html#pathology-labreport">Pathology</a>
      </li>
      <li>
        <a href="background.html#microbiology-labreport">Microbioloy</a>
      </li>
      <li>
        <a href="background.html#notes">Notes</a>
      </li>
      <li>
        <a href="background.html#imaging-reports">Radiology</a>
      </li>
      <li>
        <a href="background.html#vital-sign">Vital-Sign</a>
      </li>
      <li>
        <a href="utility.html">Utility</a>
      </li>
      <li>
        <a href="ConvertDate.html">ConvertDate</a>
      </li>
      <li>
        <a href="identifier.html">Id vs Identifier</a>
      </li>
    </ul>
  </li>
  <li>
    <a href="oh.html">Oracle Health</a>
  </li>
  <li>
    <a href="testplan.html">Test Plan</a>
  </li>
  <li>
    <a href="artifacts.html">Artifacts</a>
  </li>
  <li>
    <a href="downloads.html">About</a>
  </li>
</ul>
            </div>  <!-- /.nav-collapse -->
          </div>  <!-- /.container -->
        </nav>  <!-- /.navbar -->
      <!-- /HEADER CONTENT -->
      </div>  <!-- /container -->
    </div>  <!-- /segment-navbar -->
    <!--status-bar-->

    <div id="segment-breadcrumb" class="segment">  <!-- segment-breadcrumb -->
      <div class="container">  <!-- container -->
        <ul class="breadcrumb">
          <li><a href='toc.html'><b>Table of Contents</b></a></li><li><b>Utility Functions</b></li>

          <span style="float:right;">

            <a href="background.html">&lt;prev</a> | 

            <a href="#bottom">bottom</a>

          | <a href="ConvertDate.html">next&gt;</a>

          </span>

        </ul>
      </div>  <!-- /container -->
    </div>  <!-- /segment-breadcrumb -->

    <a name="top"> </a>
    <div id="segment-content" class="segment">  <!-- segment-content -->
      <div class="container">  <!-- container -->
        <div class="row">
          <div class="inner-wrapper">

<style type="text/css">
h2:before{color:silver;counter-increment:section;content:var(--heading-prefix) " ";}
h3:before{color:silver;counter-increment:sub-section;content:var(--heading-prefix) "." counter(sub-section) " ";}
h4:before{color:silver;counter-increment:composite;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) " ";}
h5:before{color:silver;counter-increment:detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) " ";}
h6:before{color:silver;counter-increment:more-detail;content:var(--heading-prefix) "." counter(sub-section) "." counter(composite) "." counter(detail) "." counter(more-detail)" ";}
</style>
<div class="col-12">
  <!--ReleaseHeader--><p id="publish-box">MyHealtheVet PHR FHIR API - Local Development build (v0.3.8) built by the FHIR (HL7® FHIR® Standard) Build Tools. See the <a href="https://department-of-veterans-affairs.github.io/mhv-fhir-phr-mapping/history.html">Directory of published versions</a></p><!--EndReleaseHeader-->
  <h2>Utility Functions</h2>
  





  <table class="colsi">
    <tr>
  
      <td>
        <i>Page standards status:</i> <a href="http://hl7.org/fhir/R4/versions.html#std-process" title="Standard Status">Informative</a>
        
      </td>
  
  
    </tr>
  </table>








    <p><!-- white space is critical inside of capture --></p>
<div class="markdown-toc">
<ul id="markdown-toc">
  <li><a href="#support-resources" id="markdown-toc-support-resources">Support Resources</a></li>
  <li><a href="#getpatient" id="markdown-toc-getpatient">GetPatient()</a></li>
  <li><a href="#conversions" id="markdown-toc-conversions">Conversions</a></li>
</ul>

</div>

<p>To support functions and resources:</p>

<h3 id="support-resources">Support Resources</h3>

<p>To support the primary FHIR Resources, there are some utility Resources that will be needed. These will be created upon demand, based on available details. Note that when we do not get a source <code class="language-plaintext highlighter-rouge">id</code> for the object, we will use a <code class="language-plaintext highlighter-rouge">contained</code> resource with the details we are given. Thus we will use a reference to a resource, that reference will most of the time be to a retrievable resource, but may be to a contained resource.</p>

<p>MVP decision is that these will all be contained. They will not thus be available RESTfully. And thus any references to the following ‘functions’ are really just processing the contained resource.</p>

<h4 id="getpractitioner">GetPractitioner()</h4>

<p>Note that when we do not get an <code class="language-plaintext highlighter-rouge">id</code> for the user or author, we will use a <code class="language-plaintext highlighter-rouge">contained</code> Practitioner resource with the details we are given. The following only applies to cases where we are given an <code class="language-plaintext highlighter-rouge">id</code>.</p>

<p>Input: UserTO, AuthorTO, etc</p>

<p>Return: a Practitioner resource reference</p>

<p>If a Practitioner is not found given the input parameters, then one is created and populated with the input parameters.</p>

<p>If a Practitioner is found, and the details given are different, then presume parameters are newer and use them to update the found Practitioner Resource.</p>

<p>Profiled <a href="StructureDefinition-VA.MHV.PHR.practitioner.html">Practitioner</a></p>

<h4 id="getlocation">GetLocation()</h4>

<p>Input: hospitalLocationTO, SiteTO</p>

<p>Return: a Location resource reference</p>

<p>If a Location is not found given the input parameters, then one is created and populated with the input parameters.</p>

<p>If a Location is found, and the details given are different, then presume parameters are newer and use them to update the found Location Resource.</p>

<p>Profiled <a href="StructureDefinition-VA.MHV.PHR.location.html">Location</a></p>

<h4 id="getorganization">GetOrganization()</h4>

<p>Input: organization id (e.g. Lab id)</p>

<p>Return: a Organization resource reference</p>

<p>If a Organization is not found given the input parameters, then one is created and populated with the input parameters.</p>

<p>If a Organization is found, and the details given are different, then presume parameters are newer and use them to update the found Organization Resource.</p>

<p>Profiled <a href="StructureDefinition-VA.MHV.PHR.organization.html">Organization</a></p>

<h3 id="getpatient">GetPatient()</h3>

<p>Input: ICN, PatientTO</p>

<p>Return: a Patient resource reference</p>

<p>If a Patient is not found given the input parameters, then one is created and populated with the data in MHV eVault for that Patient.</p>

<p>Profiled <a href="StructureDefinition-VA.MHV.PHR.patient.html">Patient</a></p>

<p>Note that the ICN, as mapped by Oracle Health (Cerner): Cerner uses the VA root OID as the system for the ICN.</p>

<p>MyHealtheVet patient id: We need to use a unique system value for this. I recommend</p>

<h3 id="conversions">Conversions</h3>

<p>Historic data is using different dataTypes that can be well defined</p>

<h4 id="convertdate">ConvertDate()</h4>

<p>see <a href="ConvertDate.html">ConvertDate</a></p>

<h5 id="code-lookup">Code Lookup</h5>

<p>Most of the historic data just uses strings. For MVP we are not converting codes, except for some very specific ones. This is because MHV is not scoped to be improving the quality of the data, and the use of the MHV FHIR API is driven by display use. Thus codes are not important.</p>

<p>Beyond MVP we could look to add a method to convert these enum or strings to a standards based code like LOINC, SNOMED, CVX, NDC, or other. These utilities can be based on a <a href="http://hl7.org/fhir/R4/conceptmap.html">FHIR ConceptMap</a> resource, thus making maintaining it easy.</p>

<h5 id="formal-code-systems-of-interest">Formal code systems of interest</h5>

<ul>
  <li>SCT = <code class="language-plaintext highlighter-rouge">http://snomed.info/sct</code></li>
  <li>UCUM = <code class="language-plaintext highlighter-rouge">http://unitsofmeasure.org</code></li>
  <li>LOINC = <code class="language-plaintext highlighter-rouge">http://loinc.org</code></li>
  <li>ICD = <code class="language-plaintext highlighter-rouge">http://hl7.org/fhir/R4/sid/icd-9-cm</code></li>
  <li>CPT = <code class="language-plaintext highlighter-rouge">http://www.ama-assn.org/go/cpt</code></li>
</ul>

<h5 id="va-specific-code-systems">VA specific code systems</h5>

<p>There is often a system specified, but it is specified as a simple short string. These are not acceptable in FHIR. FHIR needs a URI or URL.</p>

<ul>
  <li>HL70070 = <code class="language-plaintext highlighter-rouge">http://terminology.hl7.org/CodeSystem/v2-0487</code></li>
  <li>VUID = urn:oid:2.16.840.1.113883.6.233</li>
</ul>

<p><strong>VA Table based code systems</strong></p>

<p>There is a pattern that starts with <code class="language-plaintext highlighter-rouge">99VA</code> and is followed by a number (e.g. <code class="language-plaintext highlighter-rouge">99VA60</code>). That number is the Vista file that holds those codes. KBS has established a pattern for converting these <code class="language-plaintext highlighter-rouge">99VA</code> values into URI. There may be a version provided, but it is unreliable so do not use the version number.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">99VA60</code> = <code class="language-plaintext highlighter-rouge">http://va.gov/terminology/vistaDefinedTerms/60</code></li>
  <li><code class="language-plaintext highlighter-rouge">99VA95.3</code> = <code class="language-plaintext highlighter-rouge">http://va.gov/terminology/vistaDefinedTerms/95.3</code></li>
  <li><code class="language-plaintext highlighter-rouge">99VA61</code> = <code class="language-plaintext highlighter-rouge">http://va.gov/terminology/vistaDefinedTerms/61</code></li>
  <li><code class="language-plaintext highlighter-rouge">99VA64</code> = <code class="language-plaintext highlighter-rouge">http://va.gov/terminology/vistaDefinedTerms/64</code></li>
</ul>

<h5 id="concept-mapping">Concept mapping</h5>

<p>For every context use of a concept encoded as a string, we presume they are unique within that context. The context identifies a specific ConceptMap, and a lookup of the string in that ConceptMap will result in the mapped standard code value.</p>

<p>A failure to find a ConceptMap can be recorded simply as the given string. These cases should be logged for evaluation and possible update of the given ConceptMap.</p>

<h5 id="ucum-code">UCUM code</h5>

<p>Some of the codes used in Vista are not proper codes.</p>

<ul>
  <li><a href="ConceptMap-DrugUcumCodes.html">Drug ConceptMap</a>
    <ul>
      <li>From <a href="https://github.com/department-of-veterans-affairs/mhv-fhir-phr-mapping/blob/d3d7f9a099534bbb5c4bce882ae2e18069b822ac/mocks/DrugUcum.csv">KBS provided DrugUcum.csv</a></li>
    </ul>
  </li>
  <li>Lab (no ConceptMap is created as it is too hard to keep up to date and the csv is considered easier)
    <ul>
      <li>From <a href="https://github.com/department-of-veterans-affairs/mhv-fhir-phr-mapping/blob/d3d7f9a099534bbb5c4bce882ae2e18069b822ac/mocks/labUcum.csv">KBS provided LabUcum.csv</a></li>
    </ul>
  </li>
  <li>Other - likely VIA returns SI units that the above ConceptMaps do not include</li>
</ul>

<h5 id="ucum-si-codes">UCUM SI codes</h5>

<p>VIA seems to give us SI units or other units not found in the KBS cross reference above.</p>

<table class="grid">
  <thead>
    <tr>
      <th>VIA code</th>
      <th>Proper UCUM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/min</code></td>
      <td><code class="language-plaintext highlighter-rouge">/min</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">%</code></td>
      <td><code class="language-plaintext highlighter-rouge">%</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">in</code></td>
      <td><code class="language-plaintext highlighter-rouge">[in_i]</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">lb</code></td>
      <td><code class="language-plaintext highlighter-rouge">[lb_av]</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">F</code></td>
      <td><code class="language-plaintext highlighter-rouge">[degF]</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">cmH2O</code></td>
      <td><code class="language-plaintext highlighter-rouge">cm[H2O]</code></td>
    </tr>
  </tbody>
</table>

<h4 id="identifier">Identifier</h4>

<p>See <a href="identifier.html">Identifier vs id</a></p>




</div>
        </div>  <!-- /inner-wrapper -->
      </div>  <!-- /row -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-content -->

  <script type="text/javascript" src="assets/js/jquery.js"> </script>     <!-- note keep space here, otherwise it will be transformed to empty tag -> fails -->
  <script type="text/javascript" src="assets/js/jquery-ui.min.js"> </script>

  <script type="text/javascript" src="assets/js/window-hash.js"> </script>
  <a name="bottom"> </a>
  <div id="segment-footer" igtool="footer" class="segment">  <!-- segment-footer -->
    <div class="container">  <!-- container -->

      <div style="background-color:var(--footer-nav-bg-color)">
        <table style="width:100%">
          <tbody>
            <tr>
              <td style="text-align:left">&#xA0;

                <a href="background.html">&lt;prev</a>

              </td>
              <td style="text-align:center">
                <a href="#top">top</a>
              </td>
              <td style="text-align:right">&#xA0;

                <a href="ConvertDate.html">next&gt;</a>

              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="inner-wrapper">
        <p>
          IG &#169; 2022+ <a style="color:var(--footer-hyperlink-text-color)" href="http://va.gov">VA Digital Services</a>.  Package va.mhv.fhir.phr#0.3.8 based on <a style="color: var(--footer-hyperlink-text-color)" href="http://hl7.org/fhir/R4/">FHIR 4.0.1</a>. Generated <span title="Fri, Jul 12, 2024 09:49-0500">2024-07-12</span>
          <br/>
          <span style="color: var(--footer-highlight-text-color)">
                      Links: <a style="color: var(--footer-hyperlink-text-color)" href="toc.html">Table of Contents</a> |
                 <a style="color: var(--footer-hyperlink-text-color)" href="qa.html">QA Report</a>
                  | <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://github.com/department-of-veterans-affairs/mhv-fhir-phr-mapping/issues/new/choose">New Issue</a> | <a style="color: var(--footer-hyperlink-text-color)" target="_blank" href="https://github.com/department-of-veterans-affairs/mhv-fhir-phr-mapping/issues">Issues</a>
                
          </span>
        </p>
      </div>  <!-- /inner-wrapper -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-footer -->
  
  <div id="segment-post-footer" class="segment hidden">  <!-- segment-post-footer -->
    <div class="container">  <!-- container -->
    </div>  <!-- /container -->
  </div>  <!-- /segment-post-footer -->
  
  <!-- JS and analytics only. -->
  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script type="text/javascript" src="assets/js/bootstrap.min.js"> </script>
  <script type="text/javascript" src="assets/js/respond.min.js"> </script>
  <script type="text/javascript" src="assets/js/anchor.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard.min.js"> </script>
  <script type="text/javascript" src="assets/js/clipboard-btn.js"> </script>
  <script type="text/javascript" src="assets/js/anchor-hover.js"> </script>
  
  <!-- Analytics Below
  ================================================== -->
  </body>
</html>

